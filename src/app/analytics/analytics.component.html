<app-admin-nav></app-admin-nav>

<main class="md:ml-64 pt-20">
  <div class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 p-4 md:p-6">
    <!-- Header -->
    <div class="flex justify-between items-center mb-8">
      <div>
        <h1 class="text-3xl font-bold text-gray-800 bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent">
          Pulse Connect Analytics Dashboard
        </h1>
        <p class="text-gray-600 mt-2">Real-time monitoring of health information access in rural communities</p>
      </div>
      <button (click)="loadAllData()" class="px-4 py-2 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-700 transition-all shadow-lg flex items-center">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
        </svg>
        Refresh Data
      </button>
    </div>

    <!-- Loading State -->
    <div *ngIf="loading" class="flex justify-center items-center h-96">
      <div class="text-center">
        <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-green-500 mx-auto mb-4"></div>
        <p class="text-gray-600 text-lg">Loading comprehensive analytics data...</p>
        <p class="text-gray-500 text-sm">This may take a moment</p>
      </div>
    </div>

    <!-- Main Dashboard Grid -->
    <div *ngIf="!loading" class="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-8">
      <!-- Total Users Card -->
      <div class="bg-white rounded-xl p-6 shadow-lg border-l-4 border-green-500 transform hover:scale-105 transition-transform">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm font-medium">Total Users</p>
            <h2 class="text-3xl font-bold text-gray-800">{{stats.totalUsers | number}}</h2>
            <p class="text-green-600 text-sm mt-1">↑ 12% from last month</p>
          </div>
          <div class="bg-green-100 p-3 rounded-full">
            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
          </div>
        </div>
      </div>

      <!-- Active Courses Card -->
      <div class="bg-white rounded-xl p-6 shadow-lg border-l-4 border-blue-500 transform hover:scale-105 transition-transform">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm font-medium">Active Courses</p>
            <h2 class="text-3xl font-bold text-gray-800">14</h2>
            <p class="text-blue-600 text-sm mt-1">3 new this month</p>
          </div>
          <div class="bg-blue-100 p-3 rounded-full">
            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
            </svg>
          </div>
        </div>
      </div>

      <!-- Certificates Card -->
      <div class="bg-white rounded-xl p-6 shadow-lg border-l-4 border-purple-500 transform hover:scale-105 transition-transform">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm font-medium">Certificates Issued</p>
            <h2 class="text-3xl font-bold text-gray-800">{{stats.certificatesIssued | number}}</h2>
            <p class="text-purple-600 text-sm mt-1">↑ 24% from last month</p>
          </div>
          <div class="bg-purple-100 p-3 rounded-full">
            <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
            </svg>
          </div>
        </div>
      </div>

      <!-- Community Posts Card -->
      <div class="bg-white rounded-xl p-6 shadow-lg border-l-4 border-orange-500 transform hover:scale-105 transition-transform">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-gray-500 text-sm font-medium">Community Posts</p>
            <h2 class="text-3xl font-bold text-gray-800">{{communityStats.totalPosts | number}}</h2>
            <p class="text-orange-600 text-sm mt-1">↑ 8% from last week</p>
          </div>
          <div class="bg-orange-100 p-3 rounded-full">
            <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content Grid -->
    <div *ngIf="!loading" class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
      <!-- Left Column - Charts -->
      <div class="lg:col-span-2 space-y-6">
        <!-- User Engagement Chart -->
        <div class="bg-white rounded-xl p-6 shadow-lg">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">User Engagement Over Time</h3>
          <canvas id="userEngagementChart" class="w-full h-64"></canvas>
        </div>

        <!-- Province Statistics Chart -->
        <div class="bg-white rounded-xl p-6 shadow-lg">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Province Member Distribution</h3>
          <canvas id="provinceStatsChart" class="w-full h-64"></canvas>
        </div>

        <!-- Two Column Charts -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="bg-white rounded-xl p-6 shadow-lg">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Device Usage</h3>
            <canvas id="deviceUsageChart" class="w-full h-48"></canvas>
          </div>
          <div class="bg-white rounded-xl p-6 shadow-lg">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">Language Preferences</h3>
            <canvas id="languagePreferenceChart" class="w-full h-48"></canvas>
          </div>
        </div>
      </div>

      <!-- Right Column - Stats and Activity -->
      <div class="space-y-6">
        <!-- User Growth Card -->
        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white shadow-lg">
          <h3 class="text-lg font-semibold mb-4">User Growth</h3>
          <div class="text-3xl font-bold mb-2">+284</div>
          <p class="text-green-100">New users this month</p>
          <div class="w-full bg-green-400 rounded-full h-2 mt-3">
            <div class="bg-white h-2 rounded-full" style="width: 65%"></div>
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="bg-white rounded-xl p-6 shadow-lg">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Recent Activity</h3>
          <div class="space-y-3">
            <div *ngFor="let activity of recentActivity" class="flex items-start space-x-3 p-3 rounded-lg hover:bg-gray-50 transition-colors">
              <div [ngClass]="{
                'bg-green-100': activity.type === 'user_registered',
                'bg-blue-100': activity.type === 'certificate_issued',
                'bg-purple-100': activity.type === 'community_post'
              }" class="p-2 rounded-full">
                <svg class="w-4 h-4" [ngClass]="{
                  'text-green-600': activity.type === 'user_registered',
                  'text-blue-600': activity.type === 'certificate_issued',
                  'text-purple-600': activity.type === 'community_post'
                }" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path *ngIf="activity.type === 'user_registered'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
                  <path *ngIf="activity.type === 'certificate_issued'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                  <path *ngIf="activity.type === 'community_post'" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
                </svg>
              </div>
              <div class="flex-1">
                <p class="text-sm font-medium text-gray-800">{{activity.message}}</p>
                <p class="text-xs text-gray-500">{{activity.time}}</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Popular Courses -->
        <div class="bg-white rounded-xl p-6 shadow-lg">
          <h3 class="text-lg font-semibold text-gray-800 mb-4">Popular Courses</h3>
          <div class="space-y-4">
            <div *ngFor="let course of popularCourses" class="p-3 rounded-lg border border-gray-200 hover:border-green-300 transition-colors">
              <h4 class="font-medium text-gray-800 mb-1">{{course.title}}</h4>
              <div class="flex justify-between items-center text-sm text-gray-600">
                <span>{{course.enrollments | number}} enrollments</span>
                <span class="font-semibold text-green-600">{{course.completionRate}}% completion</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2 mt-2">
                <div class="bg-green-500 h-2 rounded-full" [style.width]="course.completionRate + '%'"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Charts Row -->
    <div *ngIf="!loading" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
      <div class="bg-white rounded-xl p-6 shadow-lg">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Course Completion Rates</h3>
        <canvas id="courseCompletionChart" class="w-full h-64"></canvas>
      </div>
      <div class="bg-white rounded-xl p-6 shadow-lg">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">Health Topic Engagement</h3>
        <canvas id="healthTopicEngagementChart" class="w-full h-64"></canvas>
      </div>
    </div>

    <!-- Impact Statement -->
    <div class="bg-gradient-to-r from-green-600 to-blue-600 rounded-xl p-8 text-white shadow-lg mb-8">
      <h2 class="text-2xl font-bold mb-4">Impact Measurement</h2>
      <p class="text-green-100 mb-6 text-lg">
        Pulse Connect is successfully bridging the health information gap in rural South African communities. 
        Our analytics demonstrate increased health literacy, community engagement, and access to critical 
        health information across all nine provinces.
      </p>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="text-center p-4 bg-white/10 rounded-lg backdrop-blur-sm">
          <div class="text-3xl font-bold">80%</div>
          <div class="text-sm text-green-100">Users in rural areas</div>
        </div>
        <div class="text-center p-4 bg-white/10 rounded-lg backdrop-blur-sm">
          <div class="text-3xl font-bold">65%</div>
          <div class="text-sm text-green-100">Offline content usage</div>
        </div>
        <div class="text-center p-4 bg-white/10 rounded-lg backdrop-lg backdrop-blur-sm">
          <div class="text-3xl font-bold">92%</div>
          <div class="text-sm text-green-100">User satisfaction rate</div>
        </div>
      </div>
    </div>
  </div>
</main>